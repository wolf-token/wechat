{template 'common/header'}

<title>{$goods['title']}</title>

{if !empty($formInfo)} 

<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.core-2.5.2.js" type="text/javascript"></script> 

<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.core-2.5.2-zh.js" type="text/javascript"></script>

<link href="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.core-2.5.2.css" rel="stylesheet" type="text/css" />

<link href="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.animation-2.5.2.css" rel="stylesheet" type="text/css" />

<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.datetime-2.5.1.js" type="text/javascript"></script> 

<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.datetime-2.5.1-zh.js" type="text/javascript"></script> 

<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.android-ics-2.5.2.js" type="text/javascript"></script>

<link href="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.android-ics-2.5.2.css" rel="stylesheet" type="text/css" />

<link href="../addons/sz_yi/template/mobile/jiyuego/static/js/star-rating.css" media="all" rel="stylesheet" type="text/css"/>

<script src="../addons/sz_yi/template/mobile/jiyuego/static/js/star-rating.js" type="text/javascript"></script> 

<script src="../addons/sz_yi/static/js/dist/ajaxfileupload.js" type="text/javascript"></script> 

<script type="text/javascript" src="../addons/sz_yi/static/js/dist/area/cascade.js"></script> 

{/if}

<div id='container'></div>

<div id='cover'><img src='../addons/sz_yi/static/images/guide.png' style='width:100%;' /></div>

<script id='goods_info'  type='text/html'>

    <input type="hidden" id="followed" value="<%followed%>" />

    <input type="hidden" id="needfollow" value="<%goods.needfollow%>" />

    <input type="hidden" id="followurl" value="<%followurl%>" />

    <input type='hidden' id='followtip' value='<%followtip%>'/>

    <!--<div class="good_topbar">

        <div class="left">

            <div class="btn back" onclick="history.back();"><i class="fa fa-chevron-left"></i></div>

        </div>

        <div class="right">

            <div class="btn cart" onclick="location.href='{php echo $this->createMobileUrl('shop/cart')}'"><i class="fa fa-shopping-cart"></i></div>

            <div class="btn func" onclick="menu(this)" ><i class="fa fa-ellipsis-v"></i></div>

        </div>

         <div class="sort_list">

                <div class="nav" onclick="location.href='<%shop.url%>'"><i class='fa fa-home'></i> 首页</div>

                <div class="nav" onclick="location.href='{php echo $this->createMobileUrl('member')}'"><i class='fa fa-user'></i> 会员中心</div>

                <div class="nav" onclick="share()" style="border:none;"><i class='fa fa-share'></i> 分享</div>

          </div>

    </div>-->

    <div class="good_choose_layer"></div>

    <div class="good_choose">

        <div class="info">

             <div class="left">

                 <img id="chooser_img" src='<%goods.thumb%>'/>

             </div>

             <div class="right">

                   <div class="price">￥<span id='option_price'><%goods.marketprice%></span></div>

                   <div class="stock">库存:<span id='option_stock'><%goods.total%></span>件</span> </div>

                   <div class="option">请选择规格</div>

             </div>

            <div class="close" onClick="closechoose()"><i class="fa fa-remove-o"></i></div>

        </div>

        <div class="other">

            <input type='hidden' id='optionid' value='' />

                <%each specs as spec%>

                <input type='hidden' name="optionid[]" class='optionid optionid_<%spec.id%>' value="" title="<%spec.title%>">

                <div class="spec"><%spec.title%></div>

                <div class="spec_items options_<%spec.id%>"  title="<%spec.title%>">

                      <%each spec.items as o%>

                      <div class="option option_<%spec.id%>" specid='<%spec.id%>' oid="<%o.id%>" sel='false' title='<%o.title%>' thumb='<%o.thumb%>'><%o.title%></div>

                     <%/each%>

                </div>

                <%/each%>



            <!--<span>diyform</span>-->



			

                {if !empty($formInfo)}

				<div id="diyform_container" >

		     {template 'diyform/formcss'}

			 <style type='text/css'>

				     .diyform_main { float:left;}

			 </style>

                         {template 'diyform/formfields'}

				</div>

                {/if}



                <div class='number'>

                  <div class='label'>购买数量</div>

                  <div class='num'>

                            <button id='btn_minus' onclick='reduceNum()'><i class='fa fa-minus'></i></button>

                            <input type='text' id='total' value='1' />

                            <button id='btn_plus' onclick='addNum()'><i class='fa fa-plus'></i></button>

                  </div>

               </div>

        </div>

        <div class="close" onClick="closechoose()"><i class="fa fa-times-circle-o"></i></div>

        <div class="sub " onClick="choose2()">确认</div>

    </div>



    <div class="good_img">

        <%if pics.length>1%>

        <div class="flicking_con">

            <div class="inner">

            <%each pics as value index %>

            <a class="<%if index==0%>on<%/if%>" href="#@"><%index%></a>

            <%/each%>

            </div>

        </div>

        <%/if%>

        <div class="main_image">

            <ul>

                <%each pics as p %>

                <li> <img src='<%p%>'/></li>

                <%/each%>

            </ul>

        </div>

    </div>

    <div class="good_info1">

        <%if commission && goods.nocommission==0 && goods.hidecommission==0%>

        <div class="info1">

            <div class="name"><%if goods.issendfree==1%><span class='label label-free'>包邮</span>&nbsp;<%/if%><%goods.title%></div>

            <div class="sub1" onclick="location.href='{php echo $this->createPluginMobileUrl('commission/shares',array('goodsid'=>$_GPC['id']))}'"><i class="fa fa-cny"></i><%commission_text%></div>

        </div>

        <%else%>

        <div class="info2"><%if goods.issendfree==1%><span class='label label-free' >包邮</span><%/if%>&nbsp;<%goods.title%></div>

        <%/if%>

        <div class="price">￥<d id='marketprice'>

                <%if goods.minprice !=goods.maxprice%>

                <%goods.minprice%> - <%goods.maxprice%>

                <%else%>

                <%goods.marketprice%>

                <%/if%>

            </d>&nbsp;<span id='productpricecontainer'><%if goods.productprice>0%>市场价￥<%/if%><span id='productprice'><%if goods.productprice>0%><%goods.productprice%><%/if%></span></span>

			 

            <span style='float:right'><d id="stockcontainer">库存:<d id="stock"><%goods.total%></d></d> 销量:<%goods.sales%><%goods.unit%></d></span>

        </div>

       

       <%if saleset && saleset.enoughfree=='1' %>

      <div class="other">

            <div class='left'>

                <%if saleset.enoughorder<=0%>

                    <span><i class='fa fa-coffee'></i> 全场包邮</span>

                 <%else%>  

                    <span><i class='fa fa-coffee'></i> 单笔订单 满 <span style='color:#ef4733'><%saleset.enoughorder%></span> 元包邮</span>

                  <%/if%>

            </div>

       </div>

        <%/if%> 

        

          <%if saleset && saleset.enoughs.length>0%>

      <div class="other1">

            <div class='left'>

                <span><i class='fa fa-birthday-cake'></i> 单笔订单

            </div>

		  <div class='right'>

			  <div class='inner'> 

		<%each saleset.enoughs as e i%><%if i<=1%>满 <span style='color:#ef4733'><%e.enough%></span> 元立减 <span style='color:#ef4733'><%e.money%></span> 元</span>;<br/><%/if%><%/each%>

		<%if saleset.enoughs.length>2%><span id='morebtn' onclick='showMoreActivity()'><i class='fa fa-angle-down'></i> 查看更多优惠<br/></span><%/if%>

		<div id='moreactivity' style='display:none'>

		<%each saleset.enoughs as e i%><%if i>1%>满 <span style='color:#ef4733'><%e.enough%></span> 元立减 <span style='color:#ef4733'><%e.money%></span> 元</span>;<br/><%/if%><%/each%>

		</div>

</div>

		  </div>

       </div>

        <%/if%> 

        

      <%if goods.deduct>0%>

      <div class="other">

            <div class='left'>

                    <span><i class='fa fa-cube'></i> 积分抵扣 <span style='color:#ef4733'><%goods.deduct%></span> 元</span>

            </div>

       </div>

        <%/if%> 

        

      <%if goods.isnodiscount=='0' && level.discount>0 && level.discount<10%>

         <div class="other">

            <div class='left'>

                <i class='fa fa-user'></i> 会员折扣 <span style='color:#ef4733'><%level.discount%></span> 折优惠(<%level.levelname%>)

            </div>

         </div> 

        <%/if%>  </div>

      </div>

      <%if goods.isverify=='2'%>

     <div class="good_speci" onclick="showStores(this)" show="1">适用的门店

         <i class="fa fa-angle-down" style="float:right; line-height:44px; font-size:26px;"></i>

     </div>

      <div>

     <%each stores as store index%>

     <%if index<=1%>

     <div class="store" >

             <div class="info">

             <div class="ico"><i class="fa fa-building-o"></i></div>

             <div class='info1'>

                 <div class='inner'>

                     <div class="user"><%store.storename%></div>

                     <div class="address">地址: <%store.address%></div>

                     <div class="tel">电话: <%store.tel%></div>

                 </div>

             </div>

             <a href="http://api.map.baidu.com/marker?location=<%store.lat%>,<%store.lng%>&title=<%store.storename%>&name=<%store.storename%>&content=<%store.address%>&output=html"><div class="ico2"><i class='fa fa-map-marker'></i></div></a>

             <a href="tel:<%store.tel%>"><div class="ico3" ><i class='fa fa-phone'></i></div></a>

        </div>

       </div>

     <%/if%>

     <%/each%> 

     <div id='store_more' style="display:none">

      <%each stores as store index%>

     <%if index>1%>

     <div class="store" >

             <div class="info">

             <div class="ico"><i class="fa fa-building-o"></i></div>

             <div class='info1'>

                 <div class='inner'>

                     <div class="user"><%store.storename%></div>

                     <div class="address">地址: <%store.address%></div>

                     <div class="tel">电话: <%store.tel%></div>

                 </div>

             </div>

             <a href="http://api.map.baidu.com/marker?location=<%store.lat%>,<%store.lng%>&title=<%store.storename%>&name=<%store.storename%>&content=<%store.address%>&output=html"><div class="ico2"><i class='fa fa-map-marker'></i></div></a>

             <a href="tel:<%store.tel%>"><div class="ico3" ><i class='fa fa-phone'></i></div></a>

        </div>

       </div>

     <%/if%>

     <%/each%> 

     </div>

    <%if stores.length>=3%>

     <div class="store_more" onclick="$('#store_more').show();$(this).remove()">显示更多 <i class="fa fa-angle-double-down"></i></div>

     <%/if%>

      </div>

     <%/if%>

   <div id="buytime" class="good_speci" style="display:none"></div>

   <div id="notbuy" class="good_speci" style="display:none"></div>

   
   <div class="jiyueshuo">
     <div class="leftcol"><img src="http://i2.buimg.com/ab6a10959e77a133.jpg"/></div>
     <div class="rightcol">买脉通个人微信号：<br/>wx-0350(长按微信号复制微信号添加好友,或者手指长按左边二维码识别添加好友)，有任何问题欢迎随时联系，朋友圈常常会有福利哦~</div>
   </div>
   
  

   <!--<%if goods.canbuy && goods.total!=0 && goods.timebuy=='0' && goods.userbuy=='1'  && goods.groupbuy=='1'  && goods.levelbuy=='1'%> 

    <div class="good_speci" onClick="choose()">

                <span id="optiondiv">请选择商品规格及数量</span>

                <i class="fa fa-angle-right" style="float:right; line-height:44px; font-size:26px;"></i>

    </div>

     <%/if%>-->

       

     <!--<div class="good_shop">

        <div class="shop1" onclick="location.href='<%detail.btnurl2%>'">

        <img src='<%detail.logo%>'/>

        <div class="shop_info"><%detail.shopname%><br><span><%if detail.totaltitle!=''%><%detail.totaltitle%><%else%>全部宝贝 <%goodscount%> 个 <%/if%></span></div></div>

        <div class="shop2">

            <div class="sub1" onclick="location.href='<%detail.btnurl1%>'"><i class="fa fa-list"></i> <%if detail.btntext1!=''%><%detail.btntext1%><%else%>查看全部商品 <%/if%></div>

            <div class="sub2" onclick="location.href='<%detail.btnurl2%>'"> <i class="fa fa-gift" o></i> <%if detail.btntext2!=''%><%detail.btntext2%><%else%>进店逛逛<%/if%></div>

        </div>

    </div>-->

	

    <div class="good_info2">

        <div class="menu">

            <div id="nav_1" class="nav navon" onClick="tab(1)">图文详情</div>

            <div id="nav_2" class="nav" onClick="tab(2)">产品参数</div>

            <div id="nav_3" class="nav" onClick="tab(3)" style="border-right:0px; width:33%">用户评价</div>

        </div>

        <div class="tab_con">

            <div class="con" id="con_1"  style='display:block'><%=goods.content%></div>

            <div class="con" id="con_2">

                <%if params.length<=0%>

                 <p class="no_params">无任何产品参数</p>

                <%/if%>

                <%each params as value%>

                <p class='param'><span><%value.title%>:</span> <%value.value%> </p>

                <%/each%>

            </div>

            <div class="con" id="con_3" ><div id='comment_container'></div></div>            

        </div>		

    </div>

	

	<div class="recommand_con" ><div class="title"><hr/><span>为你推荐</span></div><div id='recommand_container'></div></div>

    

	<div class="good_copyright">版权所有 © {if !empty($set['copyright'])}{$set['copyright']}{else}{$_W['account']['name']}{/if}</div>

 

    <%if goods.canbuy && goods.total!=0 && goods.timebuy=='0' && goods.userbuy=='1' && goods.groupbuy=='1'  && goods.levelbuy=='1'%>

    <div class="good_bottom">

        

		<div class="home" onclick="location.href='<%shop.url%>'"><i class="fa fa-home"></i><br><span>首页</span></div>

		

        <div class="like" >

            <i class="fa <%if isfavorite%>fa-heart<%else%>fa-heart-o<%/if%>" <%if isfavorite==1%>style="color:#ef4733"<%/if%>></i>

			<br><span>收藏</span>

            

        </div>

        <%if shopset.cservice%>

            <div class="cs" ><i class="fa fa-headphones"></i><br><span>客服</span></div>

            <%if goods.canaddcart%>

            <div class="cart" onclick="location.href='{php echo $this->createMobileUrl('shop/cart')}'"><i class="fa fa-shopping-cart"></i><br><span>购物车</span>

                <%if cartcount>0%><b><%cartcount%></b><%/if%>

            </div>

            <%/if%>

            <div class="add" onclick="choose('cart')" <%if shopset.cservice &&  goods.canaddcart%>style="width:20%"<%/if%>>加入购物车</div>

             <!--<div class="buy" onclick="choose('buy')" <%if shopset.cservice &&  goods.canaddcart%>style="width:20%"<%/if%>>立即购买</div>-->

        <%else%>

             <%if goods.canaddcart%>

            <div class="cart" onclick="location.href='{php echo $this->createMobileUrl('shop/cart')}'"><i class="fa fa-shopping-cart"></i><br><span>购物车</span>

                <%if cartcount>0%><b><%cartcount%></b><%/if%>

            </div>

            <%/if%>

            <div class="add" onclick="choose('cart')">加入购物车</div>

            <!--<div class="buy" onclick="choose('buy')" <%if !goods.canaddcart%>style='width:50%'<%/if%>>立即购买</div>-->

        <%/if%>

</div>

    <%/if%>



</script>

<script id='tpl_comment' type='text/html'>

    <%each list as comment%>

    <div class='comment'>

                    <div class='info'>

                        <div class='head'><img src='<%comment.headimgurl%>' style='width:30px;height:30px;' /></div>

                        <div class='nickname'><div class='inner'><%comment.nickname%></div></div>

                        <div class='level'>

                            <%if comment.level>=1%><i class='fa fa-heart'></i><%else%><i class='fa fa-heart-o'></i><%/if%>

                            <%if comment.level>=2%><i class='fa fa-heart'></i><%else%><i class='fa fa-heart-o'></i><%/if%>

                            <%if comment.level>=3%><i class='fa fa-heart'></i><%else%><i class='fa fa-heart-o'></i><%/if%>

                            <%if comment.level>=4%><i class='fa fa-heart'></i><%else%><i class='fa fa-heart-o'></i><%/if%>

                            <%if comment.level>=5%><i class='fa fa-heart'></i><%else%><i class='fa fa-heart-o'></i><%/if%>

                            </div>

                    </div>

                    <div class='content'><%comment.content%></div>

                    <%if comment.images.length>0%>

                       <div class='imgs'>

                          <%each comment.images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>

                    </div>

                    <%/if%>

                   <%if comment.reply_content!=''%>

                         <div class='content' style='margin-top:5px;'><span style='color:#ef4733'>[回复]</span><%comment.reply_content%></div>

                        <%if comment.reply_images.length>0%>

                            <div class='imgs'>

                               <%each comment.reply_images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>

                         </div>

                   <%/if%>

                      <%/if%>

              

                     <%if comment.append_content!=''%>

                         <div class='content' style='margin-top:5px;'><span style='color:#ef4733'>[追加]</span><%comment.append_content%></div>

                        <%if comment.append_images.length>0%>

                            <div class='imgs'>

                               <%each comment.append_images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>

                         </div>

                      <%/if%>

                     <%/if%>

                

                  <%if comment.append_reply_content!=''%>

                         <div class='content' style='margin-top:5px;'><span style='color:#ef4733'>[回复]</span><%comment.append_reply_content%></div>

                        <%if comment.append_reply_images.length>0%>

                            <div class='imgs'>

                               <%each comment.append_reply_images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>

                         </div>

                      <%/if%>

                     <%/if%>

             <div class='time'><%comment.createtime%></div>

     </div>

     <%/each%>

</script> 

<script id='tpl_recommand' type='text/html'>

     <%each list as g%>

    <div class="good" data-goodsid='<%g.id%>'>

        <img src='<%g.thumb%>'/>

        <div class="name"><%g.title%></div>

        <div class="price">￥<%g.marketprice%> <%if g.productprice>0 && g.marketprice!=g.productprice%><span>￥<%g.productprice%></span><%/if%></div>

    </div>

    <%/each%>

</script> 

<script id="tpl_img" type="text/html">

    <div class='img' data-img='<%filename%>'>

        <img src='<%url%>' />

        <div class='minus'><i class='fa fa-minus-circle'></i></div>

    </div>

</script> 

<script language="javascript">

  function showMoreActivity(){

	 $('#morebtn').hide();

	 $("#moreactivity").fadeIn();

 }

 

    var hasoption = false;

    var maxbuy = 0;

    var options = [];

    var specs = [];

    var tip = null;

    var action="";

    var alpha = 0;



    

    function share(){

        

           $('#cover').fadeIn(200).unbind('click').click(function(){

                    $(this).fadeOut(100);

          })

    }

    function menu(obj){

       

        if($(obj).attr('show')=='1'){

            $(obj).removeAttr('show');

            $('.sort_list').fadeOut(200);

        }else{

            $(obj).attr('show','1');  

            $('.sort_list').fadeIn(200);

        }

    }

    $(function(){

        $(document.body).click(function(e){

           var classname = "";

           

            if($(e.target).get(0) ){

                classname =$(e.target).get(0).className;

            }

            if(classname!='fa fa-ellipsis-v' && classname!='btn func') {

                

                $('.func').removeAttr('show');

                $('.sort_list').fadeOut(200);

            }

        });

    })

    function showStores(obj){

        if($(obj).attr('show')=='1'){

            $(obj).next('div').slideUp(100);

            $(obj).removeAttr('show').find('i').removeClass('fa-angle-down').addClass('fa-angle-up');

        }

        else{

            $(obj).next('div').slideDown(100);

            $(obj).attr('show','1').find('i').removeClass('fa-angle-up').addClass('fa-angle-down');

        }

    }

    require(['tpl', 'core','jquery.touchslider','swipe'], function(tpl, core) {

      function setTimer(goods){

            

            setTimeHtml(goods);

            window.timer = setInterval(function(){

                setTimeHtml(goods);

            },1000);

        }

        function setTimeHtml(goods){

            var current = Math.floor(new Date().getTime()/1000);

                var ts = 0;//计算剩余的毫秒数

                var prefix = '';

                

                if(goods.timestate=='before'){

                    ts = goods.timestart - current;

                    prefix = "限时购开始倒计时: ";

                    if(ts<=0){

                        location.reload();

                    }

                }

                else if(goods.timestate=='after'){

                    ts = goods.timeend - current;

                    

                    prefix = "限时购结束倒计时:  ";

                     if(ts<=0){

                        location.reload();

                    }

                }

                var dd = parseInt(ts / 60 / 60 / 24, 10);//计算剩余的天数

                var hh = parseInt(ts  / 60 / 60 % 24, 10);//计算剩余的小时数

                var mm = parseInt(ts  / 60 % 60, 10);//计算剩余的分钟数

                var ss = parseInt(ts % 60, 10);//计算剩余的秒数

                dd = checkTime(dd);

                hh = checkTime(hh);

                mm = checkTime(mm);

                ss = checkTime(ss);

                $('.timestate').html(prefix+ "<span>" + dd + "</span>天<span>" + hh + "</span>时<span>" + mm + "</span>分<span>" + ss + "</span>秒");

        }

        function checkTime(i)    

            {    

               if (i < 10) {    

                   i = "0" + i;    

                }    

               return i;    

            } 



        core.json('shop/detail',{id:'{$_GPC['id']}',mid:"{$mid}"},function(json){

     

          tip = core.tip;

          if(json.status<=0){

              core.message('没有找到您想要的宝贝哦~',"{php echo $this->createMobileUrl('shop/list')}",'error');

              return;

          }

            

        $(window).scroll(function(){

         

           var top = $(document).scrollTop() ;

           alpha = top/270 ;

           if(alpha>0.5){

               alpha = 0.5;

           }

           $('.good_topbar').css("background","rgba(237,237,237,"+ alpha + ")");

             $('.good_topbar .btn').css("background","rgba(237,237,237,"+ (0.5-alpha) + ")");

        });

         $('body').on("touchmove",function(){

                

           var top = $(document).scrollTop() ;

           alpha = top/270 ;

           if(alpha>0.6){

               alpha = 0.6;

           }

          $('.good_topbar').css("background","rgba(237,237,237,"+ alpha + ")");

          $('.good_topbar .btn').css("background","rgba(237,237,237,"+ (0.6-alpha) + ")");

        });

        

          $('#container').html(  tpl('goods_info',json.result) ); 

    

          var bh = $(document.body).height() - 50;

          $('.good_choose').css('max-height',bh); 

          $('.good_choose .other').css('max-height',bh-175);

       

         // alert(document.body.clientWidth);

         $('.good_img').height( document.body.clientWidth + "px");

              

          $('#con_1 img,#con_1 table,#con_1 div').width('100%');

           var ua = navigator.userAgent.toLowerCase();

           var isWX = ua.match(/MicroMessenger/i) == "micromessenger";

           var z = []; 

           $(".main_image img").each(function() {

                z.push($(this).attr("src"));

            });

            var current;

            if (isWX) {

                $(".main_image img").click(function(e) {

                    e.preventDefault();

                    var startingIndex = $(".main_image img").index($(e.currentTarget));

                    var current = null;

                    $(".main_image img").each(function(B, A) {

                        if (B === startingIndex) {

                            current = $(A).attr("src");

                        }

                    });

                    WeixinJSBridge.invoke("imagePreview", {

                        current: current,

                        urls: z

                    });

                });

            }

            

              var z1 = []; 

           $("#con_1 img").each(function() {

                z1.push($(this).attr("src"));

            });

            var current1;

            if (isWX) {

                $("#con_1 img").click(function(e) {

                    e.preventDefault();

                    var startingIndex = $("#con_1 img").index($(e.currentTarget));

                    var current = null;

                    $("#con_1 img").each(function(B, A) {

                        if (B === startingIndex) {

                            current1 = $(A).attr("src");

                        }

                    });

               

                    WeixinJSBridge.invoke("imagePreview", {

                        current: current1,

                        urls: z1

                    });

                });

            }

            

      

            

           document.title = json.result.goods.title;

           hasoption = json.result.options.length>0;

           goods = json.result.goods;

           maxbuy = json.result.goods.maxbuy;

           options = json.result.options;

           specs = json.result.specs;

           

           nothtml = "";

           timehtml = "";

           hastime = false;

            if( goods.canbuy){

                     if(goods.userbuy=='0') {

                               nothtml = "您已超出购买上限~";

                     } else {

                              if( goods.groupbuy=='0' || goods.levelbuy=='0'){

                                         nothtml="您不能购买此商品,请联系客服";

                             } else {

                                        if( goods.total==0){

                                                 nothtml="库存不足，无法购买";

                                        } else {

                                                 if( goods.istime=='1'){

                                                      if( goods.timebuy=='1'){

                                                          nothtml= "限时购活动已经结束，请下次再来~"

                                                      }else{//未开始倒计时或进行中

                                                          nothtml='<span class="timestate"></span>';

                                                          hastime = true;

                                                      }

                                                 }

                                        }

                             }



                    }

                     if( goods.istime=='1'){

                                                      if( goods.timebuy!='1'){

                                                         

                                                          timehtml = '<span class="timestate"></span>';

                                                      }

                                                 }

                     

        }else{

            nothtml = "商品已下架";

        }

        if( nothtml!=''){

            $('#notbuy').html(nothtml).show();

        }

        if( timehtml!='' && !hastime){

            $('#buytime').html(timehtml).show();

        }

        if($('.timestate').length>0) {

               if(goods.timestate!=''){

                     setTimer(goods);

               }

        }

            

           

           if(options.length>0){

             $('#productpricecontainer').html('');

           }

   

           $('#total').blur(function(){

              var total = $("#total");

	if(!total.isInt()){

	     total.val("1");

                       return;

	}

                  if(parseInt(total.val())<=0){

	     total.val("1");

                       return;

	} 

	var stock = $("#stock").html()==''?-1:parseInt($("#stock").html());

	var num = parseInt(total.val() );

                  if(num>maxbuy && maxbuy>0){

		tip.show("您最多可购买 " + maxbuy + " 件!");

		num = maxbuy;

	}

	else if(num>stock && stock!=-1){

		tip.show("您最多可购买 " + stock + " 件");

		num = stock;

	}

	

	total.val(num);

        

               

           });

 

               

                    new Swipe($('.main_image')[0], {

			speed:300,

			auto:4000,

			callback: function(){

			  

                                 $(".flicking_con  .inner  a").removeClass("on").eq(this.index).addClass("on");

		}

	  });

            {if !empty($formInfo)}

            {template 'diyform/common_js'}

            {/if}



            $(".option").click(function() {

               

			 var specid = $(this).attr("specid");

			 var oid = $(this).attr("oid");

			$(".optionid_"+specid).val(oid);

			$(".options_" + specid + "  .option").removeClass("on").attr("sel", "false");

			$(this).addClass("on").attr("sel", "true");

	 

             var titles='已选: ';

			     $('.spec_items').each(function(){

                                 if($(this).find('.on').length>0){

			        titles+= $(this).find('.on').attr('title')+";";   

                            }

			     });

                             

                             $('.good_choose .info .right .option').html(titles);

         var thumb = $(this).attr('thumb');

         if(thumb!=''){

             $("#chooser_img").attr('src',thumb);

         }

         else{

             

             $("#chooser_img").attr('src',json.result.goods.thumb);

         }

         setoptions();

			var optionid = "";

			var stock =0;

			var marketprice = 0;

			var productprice = 0;

			 var ret = option_selected();

  

			if(ret.no==''){

				var len = options.length;

				for(var i=0;i<len;i++) {

					var o = options[i];

					var ids = ret.all.join("_");

                                

                                var specarr = o.specs.split('_').sort();

                                var idsarr = ret.all.sort();

                              

                                

                                

                             

					if(specarr.join('_') ==idsarr.join('_') ){

						optionid = o.id;

						stock = o.stock;

						marketprice = o.marketprice;

						productprice = o.productprice;

						break;

					}

					

				}

                                

			   $("#optionid").val(optionid); 

			    

				if(stock!="-1"){

					$("#stockcontainer").html("库存:<span id='stock'>" + stock + "</span>");

				}

				else{

				  $("#stockcontainer").html("<span id='stock'></span>");

				}

				if(ret.no==''){

					if(stock==0){

					   $('.sub').addClass('disabled').html('库存不足,无法购买');

					}

					else{

					 $('.sub').removeClass('disabled').html('确认');

					}

				} 

				$("#marketprice").html(marketprice);

				

		     	$("#option_price").html(marketprice);	

		     	$("#option_stock").html(stock);	

				 

				$("#productprice").html(productprice);

				if(productprice<=0){

				$('#productpricecontainer').html("");

				}

				else{

			

				   $('#productpricecontainer').html("市场价￥<span id='productprice'>" + productprice + "</span>");

				}

			}

		});

                

           

    $('.cs').click(function(){

            location.href='{php echo $shopset['cservice']}&metadata={"name":"{php echo $member['nickname']}","tel":"{php echo $member['mobile']}","address":"{php echo $member['province']}"}';

    });

    

                $('.like').click(function(){

                    var self = $(this);

                    require(['core'],function(core){

                       core.json('shop/favorite',{op:'set', id:'{$_GPC['id']}'},function(ret){

                           if(ret.status==1){

                

                                if(ret.result.isfavorite){

                                   self.find('i').removeClass('fa-heart-o').addClass('fa-heart').css('color','#ef4733');

                                }

                                else{

                                   self.find('i').addClass('fa-heart-o').removeClass('fa-heart').css('color','#333');

                                }

                           }

                           else{

                               core.tip.show('操作失败');

                           }

                       });

                      },false,true);

                });

                var page = 1;

          function bindCommentImages(){

                var z = []; 

                          $(".comment .imgs img").each(function() {

                             z.push($(this).attr("src"));

                         });

                         var current;

                         if (isWX) {

                             $(".comment .imgs  img").click(function(e) {

                                 e.preventDefault();

                                 var startingIndex = $(".comment .imgs  img").index($(e.currentTarget));

                                 var current = null;

                                 $(".comment .imgs  img").each(function(B, A) {

                                     if (B === startingIndex) {

                                         current = $(A).attr("src");

                                     }

                                 });

                                 WeixinJSBridge.invoke("imagePreview", {

                                     current: current,

                                     urls: z

                                 });

                             });

                         }

          }

                $('#nav_3').click(function(){

                    page = 1;

                     core.json('shop/util',{op:'comment', page:page,goodsid:'{$_GPC['id']}'},function(json){

                         if(json.result.list.length<=0){

                             $('#comment_container').html('<p class=no_comment>暂时没有任何评价</p>');

                             return;

                         }

                         $('#comment_container').html( tpl('tpl_comment',json.result));

                       bindCommentImages();

                            var loaded = false;

                              var stop=true; 

                              $(window).scroll(function(){ 

                                  if(loaded){

                                      return;

                                  }

                                    totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); 

                                    if($(document).height() <= totalheight){ 



                                        if(stop==true){ 

                                            stop=false; 

                                            $('#comment_container').append('<div id="comment_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');

                                            page++;

                                            core.json('shop/util', {op:'comment',page:page,goodsid:'{$_GPC['id']}'}, function(morejson) {  

                                                stop = true;

                                                $('#comment_loading').remove();

                                                $("#comment_container").append(tpl('tpl_comment', morejson.result));

                                                  bindCommentImages();

                                                if (morejson.result.list.length <morejson.result.pagesize) {



                                                    $("#comment_container").append('<div id="comment_loading">已经加载完全部评价</div>');

                                                    loaded = true;

                                                    $(window).scroll = null;

                                                    return;

                                                }

                                            },true); 

                                        } 

                                    } 

                                });

                     });

                 });

                 

                 $(function(){

                      core.json('shop/util',{op:'recommand'},function(json){

                         if(json.result.list.length<=0){

                             $('#recommand_container').html('暂时没有同店推荐');

                             return;

                         }

                         $('#recommand_container').html( tpl('tpl_recommand',json.result));

                         $('#recommand_container .good').click(function(){

                            location.href = core.getUrl('shop/detail',{id:$(this).data('goodsid') });

                         }).find('img').each(function(){

                             $(this).height($(this).width());

                         });

                         

                     });

                 });

        },true);

        

    })

</script> 

<script type="text/javascript">

	function tab(n){

		$('#con_'+n).fadeIn();

		$('#con_'+n).siblings().hide();

		$('#nav_'+n).addClass('navon');

		$('#nav_'+n).siblings().removeClass('navon');

                      

	}

        function closechoose(){

                 $('.good_choose_layer').fadeOut(100);

		$('.good_choose').fadeOut(100); 

        }

	function choose(act){

                          if($('#followed').val()=='0'  && $('#needfollow').val()=='1' ){

                                require(['core'],function(core){

                                    core.tip.confirm($('#followtip').val(),function(){

                                        location.href = $('#followurl').val();

                                        return;

                                    }) 

                                });

                             return;

                          }

	               action = act;

                         if(!action){

                                     

                                $('.good_choose_layer').fadeIn(200);

                                $('.good_choose_layer').unbind('click').click(function(){

                                    $('.good_choose_layer').fadeOut(100);

                                    $('.good_choose').fadeOut(100); 

                                })

                                $('.good_choose').fadeIn(200);

                                return;

                         }

                         var specselected  = '';

  if( action=='cart'){

			 $('.good_choose_layer').fadeIn(200);

							 $('.good_choose_layer').unbind('click').click(function(){

								   closechoose();

							 })

			   $('.good_choose').fadeIn(200);

			   return;	 

	         }else{

			{if !empty($formInfo)}

				 $('.good_choose_layer').fadeIn(200);

							 $('.good_choose_layer').unbind('click').click(function(){

								   closechoose();

							 })

			   $('.good_choose').fadeIn(200);

			   return;

			{/if}

			 

				$('.spec_items').each(function(){

							 var self = $(this);

				                            if( $(this).find('.on').length<=0){

								 specselected = self.attr('title');

								 return false;

							  }

				});  

		     if(specselected!='') {

			   $('.good_choose_layer').fadeIn(200);

							 $('.good_choose_layer').unbind('click').click(function(){

								   closechoose();

							 })

			   $('.good_choose').fadeIn(200);

			   return;

		     }

			

		 }

 



                      var diymode = {php echo intval($diymode)};



                      if(specselected!='' || diymode==1) {

                             if (specselected == '') {

                                 $('#goods_spec').hide();

                             }



                             $('.good_choose_layer').fadeIn(200);

                             $('.good_choose_layer').unbind('click').click(function(){

                                 closechoose();

                             })

	                    $('.good_choose').fadeIn(200);

                      } else{

                          if(action=='cart'){

                                                require(['core'],function(core){



                                                                           core.json('shop/cart',{op:'add', id:'{$_GPC['id']}',optionid:$('#optionid').val(),total:$('#total').val()},function(ret){

                                                                                                        if(ret.status==1){

                                                                                                           core.tip.show(ret.result.message);

                                                                                                           var cartdiv = $('.cart');

                                                                                                                               if( cartdiv.find('b').length<=0){

                                                                                                                                  cartdiv.append('<b>'+ ret.result.cartcount +"</b>");

                                                                                                                               }

                                                                                                                               else {

                                                                                                                                  cartdiv.find('b').html(ret.result.cartcount);

                                                                                                                               }



                                                                                                       } else{

                                                                                                           core.message(ret.result,'','error');

                                                                                                       }

                                                                               },true,true);

                                                 });

                                    }else if(action=='buy'){

                                         location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val();

                                    }



                      }

	}

        function setoptions(){

             var titles = '';

   		         if(hasoption){

			     

			 titles+='已选: ';

			     $('.spec_items').each(function(){

 			        titles+= $(this).find('.on').attr('title')+";";   

			     });

		         }

                                             titles+='数量:' + $('#total').val();

		         $("#optiondiv").html(titles);

        }

	function choose2(direct,close){

		 require(['core'],function(core){

			 

            if(close){

                closechoose();

                return;

            }

	    if(!direct){

		    if($('.sub').hasClass('disabled')){

		       return;

		    }

		    else{

		        setoptions();

		    }

                                      

		  

	    } else {

                            action = "";

                      }

		

                var specselected  = '';

                

	    $('.spec_items').each(function(){

                

                   var self = $(this);

 		 if( $(this).find('.on').length<=0){

                                          specselected = self.attr('title');

                                          return false;

                      }

                               });  

                                if( specselected!=''){

                                      require(['core'],function(core){

                                         core.tip.show('请选择' + specselected) ;

                                      });

                                      return;

                      }

                               

                           

                              

		if(action=='cart'){

			     var data = {};

				 

			     {if !empty($formInfo)}

				 

					{template 'diyform/common_js_data'}



				         data = {

						'diyformid': "{$goods['diyformid']}",

						'diydata':diydata

					};

				{/if}

        //openid

                                {if !empty($popenid) or !empty($openid)}

                                                                           core.json('shop/cart',{op:'add', id:'{$_GPC['id']}',optionid:$('#optionid').val(),total:$('#total').val(),diyformdata:data},function(ret){

                                                                                                        if(ret.status==1){ 

                                                                                                           core.tip.show(ret.result.message);

                                                                                                           var cartdiv = $('.cart');

                                                                                                                               if( cartdiv.find('b').length<=0){

                                                                                                                                  cartdiv.append('<b>'+ ret.result.cartcount +"</b>");

                                                                                                                               }

                                                                                                                               else {

                                                                                                                                  cartdiv.find('b').html(ret.result.cartcount);

                                                                                                                               } closechoose();



                                                                                                       } else{

                                                                                                           core.message(ret.result,'','error');

                                                                                                       }

                                                                               },true,true);

                                

                            {else}

                                         location.href = "{php echo $this->createMobileUrl('member/login')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val();

                            {/if}

        //end openid

                                            

                                    }else if(action=='buy'){

 

               {if !empty($formInfo)}

				  

                {template 'diyform/common_js_data'}



                var data ={

                    'op': 'create',

                    'id': {$_GPC['id']},

                    'diydata': diydata

                };



                require(['core'],function(core){

                    core.json('shop/detail', data, function(create_json) {

                        if (create_json.status == 1) {

                            location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val()+ "&gdid="+create_json.result.goods_data_id;

                        } else {

                            core.tip.show("提交失败!")

                        }



                        return false;



                    }, true, true);

                })



                {else}

                    location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val();

                {/if}



                    } else {

							 closechoose();

		}

  });

	}

  function addNum(){

	var total = $("#total");

	if(!total.isInt()){

		total.val("1");

	}

	var stock = $("#stock").html()==''?-1:parseInt($("#stock").html());

	var num = parseInt(total.val() ) + 1;

                  if(num>maxbuy && maxbuy>0){

		tip.show("您最多可购买 " + maxbuy + " 件!");

		num = maxbuy;

	}

	else if(num>stock && stock!=-1){

		tip.show("您最多可购买 " + stock + " 件");

		num = stock;

	}

	total.val(num);

}

function reduceNum(){

	var total = $("#total");

	if(!total.isInt()){

		total.val("1");

	}

	var num = parseInt( total.val() );

	if(num-1<=0){

		return;

	}

	num--;

	total.val(num);

}



	function option_selected(){

	var ret= {

		no: "",

		all: []

	};

	if(!hasoption){

		return ret;

	}

			$(".optionid").each(function(){

				ret.all.push($(this).val());

				if($(this).val()==''){

					ret.no = $(this).attr("title");

					return false;

				}

	})

	return ret;

}

</script> 

{php $show_copyright=true;$hide_footer=1}

{template 'common/footer'} 